"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var coffee_lex_1 = require("coffee-lex");
var InterpolatedPatcher_1 = require("./InterpolatedPatcher");
/**
 * Patcher to handle all types of strings, whether or not they have
 * interpolations and whether or not they are multiline.
 */
var StringPatcher = (function (_super) {
    tslib_1.__extends(StringPatcher, _super);
    function StringPatcher() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    StringPatcher.prototype.patchAsExpression = function () {
        var shouldBecomeTemplateLiteral = this.shouldBecomeTemplateLiteral();
        var escapeStrings = [];
        var openQuoteToken = this.firstToken();
        var closeQuoteToken = this.lastToken();
        if (shouldBecomeTemplateLiteral) {
            escapeStrings.push('`');
            escapeStrings.push('${');
            this.overwrite(openQuoteToken.start, openQuoteToken.end, '`');
            this.overwrite(closeQuoteToken.start, closeQuoteToken.end, '`');
        }
        else if (openQuoteToken.type === coffee_lex_1.SourceType.TSSTRING_START) {
            escapeStrings.push('\'');
            this.overwrite(openQuoteToken.start, openQuoteToken.end, '\'');
            this.overwrite(closeQuoteToken.start, closeQuoteToken.end, '\'');
        }
        else if (openQuoteToken.type === coffee_lex_1.SourceType.TDSTRING_START) {
            escapeStrings.push('"');
            this.overwrite(openQuoteToken.start, openQuoteToken.end, '"');
            this.overwrite(closeQuoteToken.start, closeQuoteToken.end, '"');
        }
        this.patchInterpolations();
        this.processContents();
        if (escapeStrings.length > 0) {
            this.escapeQuasis(/^\\/, escapeStrings);
        }
    };
    StringPatcher.prototype.shouldBecomeTemplateLiteral = function () {
        return this.expressions.length > 0 || this.node.raw.indexOf('\n') > -1;
    };
    return StringPatcher;
}(InterpolatedPatcher_1.default));
exports.default = StringPatcher;
