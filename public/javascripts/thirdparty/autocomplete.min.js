String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};var AutoComplete=Class.create();
AutoComplete.prototype={Version:"1.3.0",REQUIRED_PROTOTYPE:"1.6.0",initialize:function(a,b){this.PROTOTYPE_CHECK();AutoComplete.prototype.log=typeof MAU!="undefined"?MAU.log:function(){};this.fld=$(a);if(!this.fld)throw"AutoComplete requires a field id to initialize";this.sInp="";this.nInpC=0;this.aSug=[];this.iHigh=0;this.options=b?b:{};var c,d={valueSep:"",minchars:1,meth:"get",varname:"input",className:"autocomplete",timeout:3E3,delay:500,offsety:-5,shownoresults:true,noresults:"No results were found.",
maxheight:250,cache:true,maxentries:25,onAjaxError:null,setWidth:false,minWidth:100,maxWidth:200,useNotifier:true};for(c in d)if(typeof this.options[c]!=typeof d[c])this.options[c]=d[c];this.options.useNotifier&&this.fld.addClassName("ac_field");var e=this;this.fld.onkeypress=function(h){return e.onKeyPress(h)};this.fld.onkeyup=function(h){return e.onKeyUp(h)};this.fld.onblur=function(){e.resetTimeout();return true};this.fld.setAttribute("AutoComplete","off")},convertVersionString:function(a){a=a.split(".");
return parseInt(a[0])*1E5+parseInt(a[1])*1E3+parseInt(a[2])},PROTOTYPE_CHECK:function(){if(typeof Prototype=="undefined"||typeof Element=="undefined"||typeof Element.Methods=="undefined"||this.convertVersionString(Prototype.Version)<this.convertVersionString(this.REQUIRED_PROTOTYPE))throw"AutoComplete requires the Prototype JavaScript framework >= "+this.REQUIRED_PROTOTYPE;},onKeyPress:function(a){if(!a)a=window.event;switch(a.keyCode||a.which){case Event.KEY_RETURN:this.setHighlightedValue();Event.stop(a);
break;case Event.KEY_TAB:this.setHighlightedValue();break;case Event.KEY_ESC:this.clearSuggestions();break}return true},onKeyUp:function(a){if(!a)a=window.event;var b=a.keyCode||a.which;if(b==Event.KEY_UP||b==Event.KEY_DOWN){this.changeHighlight(b);Event.stop(a)}else this.getSuggestions(this.fld.value);return true},getSuggestions:function(a){if(a==this.sInp)return false;$(this.acID)&&$(this.acID).remove();this.sInp=a;if(a.length<this.options.minchars){this.aSug=[];this.nInpC=a.length;return false}var b=
this.nInpC;this.nInpC=a.length?a.length:0;var c=this.aSug.length;if(this.options.cache&&this.nInpC>b&&c&&c<this.options.maxentries){b=[];for(var d=0;d<c;d++)this.aSug[d].value.toLowerCase().indexOf(a.toLowerCase())!=-1&&b.push(this.aSug[d]);this.aSug=b;this.createList(this.aSug)}else{var e=this;clearTimeout(this.ajID);this.ajID=setTimeout(function(){e.doAjaxRequest(e.sInp)},this.options.delay)}document.helper=this;return false},getLastInput:function(a){a=a;if(undefined!=this.options.valueSep){var b=
a.lastIndexOf(this.options.valueSep);a=b==-1?a:a.substring(b+1,a.length)}return a.ltrim()},doAjaxRequest:function(a){if(a!=this.fld.value)return false;this.sInp=this.getLastInput(this.sInp);if(this.sInp.length<this.options.minchars)return false;var b=typeof this.options.script=="function"?this.options.script(encodeURIComponent(this.sInp)):this.options.script+this.options.varname+"="+encodeURIComponent(this.sInp);if(!b)return false;var c=this;new Ajax.Request(b,{method:this.options.meth,onSuccess:function(d){if(c.options.useNotifier){c.fld.removeClassName("ac_field_busy");
c.fld.addClassName("ac_field")}c.setSuggestions(d,a)},onFailure:typeof c.options.onAjaxError=="function"?function(d){if(c.options.useNotifier){c.fld.removeClassName("ac_field_busy");c.fld.addClassName("ac_field")}c.options.onAjaxError(d)}:function(d){if(c.options.useNotifier){c.fld.removeClassName("ac_field_busy");c.fld.addClassName("ac_field")}this.log("AJAX error: "+d)}})},setSuggestions:function(a,b){if(b!=this.fld.value)return false;this.aSug=[];if(this.options.json)this.aSug=eval("("+a.responseText+
")");else for(var c=a.responseXML.getElementsByTagName("results")[0].childNodes,d=0;d<c.length;d++)c[d].hasChildNodes()&&this.aSug.push({id:c[d].getAttribute("id"),value:c[d].childNodes[0].nodeValue,info:c[d].getAttribute("info")});this.acID="ac_"+this.fld.id;this.createList(this.aSug)},createDOMElement:function(a,b,c,d){a=document.createElement(a);if(!a)return 0;for(var e in b)a[e]=b[e];b=typeof c;if(b=="string"&&!d)a.appendChild(document.createTextNode(c));else if(b=="string"&&d)a.innerHTML=c;else b==
"object"&&a.appendChild(c);return a},createList:function(a){$(this.acID)&&$(this.acID).remove();this.killTimeout();if(a.length==0&&!this.options.shownoresults)return false;var b=this.createDOMElement("div",{id:this.acID,className:this.options.className}),c=this.createDOMElement("div",{className:"ac_corner"}),d=this.createDOMElement("div",{className:"ac_bar"}),e=this.createDOMElement("div",{className:"ac_header"});e.appendChild(c);e.appendChild(d);b.appendChild(e);c=this.createDOMElement("ul",{id:"ac_ul"});
var h=this;if(a.length==0&&this.options.shownoresults){var g=this.createDOMElement("li",{className:"ac_warning"},this.options.noresults);c.appendChild(g)}else{d=0;for(e=a.length;d<e;d++){g=a[d].value;var f=g.toLowerCase().indexOf(this.sInp.toLowerCase());g=this.createDOMElement("span",{},g.substring(0,f)+"<em>"+g.substring(f,f+this.sInp.length)+"</em>"+g.substring(f+this.sInp.length),true);if(a[d].info!=""){f=this.createDOMElement("br",{});g.appendChild(f);f=this.createDOMElement("small",{},a[d].info);
g.appendChild(f)}f=this.createDOMElement("a",{className:"lkdark",href:"#"});var i=this.createDOMElement("span",{className:"tl"},"&nbsp;",true),j=this.createDOMElement("span",{className:"tr"},"&nbsp;",true);f.appendChild(i);f.appendChild(j);f.appendChild(g);f.name=d+1;f.onclick=function(){h.setHighlightedValue();return false};f.onmouseover=function(){h.setHighlight(this.name)};g=this.createDOMElement("li",{},f);if(d==0){g.addClassName("first");this.log(g)}d==e-1&&g.addClassName("last");c.appendChild(g)}}b.appendChild(c);
a=this.createDOMElement("div",{className:"ac_corner"});c=this.createDOMElement("div",{className:"ac_bar"});d=this.createDOMElement("div",{className:"ac_footer"});d.appendChild(a);d.appendChild(c);b.appendChild(d);a=this.fld.viewportOffset();b.style.left=a[0]+"px";b.style.top=a[1]+this.fld.offsetHeight+"px";b.style.width=(this.options.setWidth&&this.fld.offsetWidth<this.options.minWidth?this.options.minWidth:this.options.setWidth&&this.fld.offsetWidth>this.options.maxWidth?this.options.maxWidth:this.fld.offsetWidth)+
"px";b.onmouseover=function(){h.killTimeout()};b.onmouseout=function(){h.resetTimeout()};document.getElementsByTagName("body")[0].appendChild(b);this.iHigh=1;this.setHighlight(1);this.toID=setTimeout(function(){h.clearSuggestions()},this.options.timeout);if(this.options.useNotifier){this.fld.removeClassName("ac_field");this.fld.addClassName("ac_field_busy")}},changeHighlight:function(a){var b=$("ac_ul");if(!b)return false;a=a==Event.KEY_DOWN||a==Event.KEY_TAB?this.iHigh+1:this.iHigh-1;a=a>b.childNodes.length?
b.childNodes.length:a<1?1:a;this.setHighlight(a)},setHighlight:function(a){var b=$("ac_ul");if(!b)return false;this.iHigh>0&&this.clearHighlight();this.iHigh=Number(a);b.childNodes[this.iHigh-1].addClassName("ac_highlight");this.killTimeout()},clearHighlight:function(){var a=$("ac_ul");if(!a)return false;if(this.iHigh>0){a.childNodes[this.iHigh-1].removeClassName("ac_highlight");this.iHigh=0}},setHighlightedValue:function(){if(this.iHigh)if(this.aSug[this.iHigh-1]){if(undefined!=this.options.valueSep){var a=
this.getLastInput(this.fld.value),b=this.fld.value.lastIndexOf(a);a=this.aSug[this.iHigh-1].value+this.options.valueSep}else{a=this.getLastInput(this.fld.value);b=this.fld.value.lastIndexOf(a);a=this.aSug[this.iHigh-1].value}this.sInp=this.fld.value=b==-1?a:this.fld.value.substring(0,b)+a;this.fld.focus();this.fld.selectionStart&&this.fld.setSelectionRange(this.sInp.length,this.sInp.length);this.clearSuggestions();typeof this.options.callback=="function"&&this.options.callback(this.aSug[this.iHigh-
1])}},killTimeout:function(){clearTimeout(this.toID)},resetTimeout:function(){this.killTimeout();var a=this;this.toID=setTimeout(function(){a.clearSuggestions()},a.options.timeout)},clearSuggestions:function(a){if(typeof a=="undefined"||a==null)a=true;this.killTimeout();$(this.acID)&&this.fadeOut(300,function(){a&&$(this.acID).remove()})},fadeOut:function(a,b){this._fadeFrom=1;this._fadeTo=0;this._afterUpdateInternal=b;this._fadeDuration=a;this._fadeInterval=50;this._fadeTime=0;var c=this;this._fadeIntervalID=
setInterval(function(){c._changeOpacity()},this._fadeInterval)},_changeOpacity:function(){if($(this.acID)){this._fadeTime+=this._fadeInterval;var a=Math.round((this._fadeFrom+(this._fadeTo-this._fadeFrom)*(this._fadeTime/this._fadeDuration))*100),b=a/100,c=$(this.acID);if(c.filters)try{c.filters.item("DXImageTransform.Microsoft.Alpha").opacity=a}catch(d){c.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+a+")"}else c.style.opacity=b;if(this._fadeTime>=this._fadeDuration){clearInterval(this._fadeIntervalID);
typeof this._afterUpdateInternal=="function"&&this._afterUpdateInternal()}}else this._fadeIntervalID=clearInterval(this._fadeIntervalID)}};
